<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>WoT Duo — SaXon vs Devil_484</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700;900&family=Roboto+Condensed:wght@400;700;900&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}

:root{
  --gold:#b8860b;
  --gold2:#ffd966;

  --p1:#7cb342;
  --p1a:#aeea00;
  --p1txt:#dfffdc;

  --p2:#ff7043;
  --p2a:#ffab91;
  --p2txt:#ffe0d7;

  --radius:30px;
}

body{
  background:transparent!important;
  font-family:'Roboto Condensed','Segoe UI',sans-serif;
  color:#eee;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:14px;
}

.wrap{
  width:980px;
  display:flex;
  gap:24px;
  align-items:stretch;
}

/* CARD */
.card{
  flex:1;
  position:relative;
  border-radius:var(--radius);
  padding:22px;
  border:1px solid rgba(184,134,11,.35);
  background:
    radial-gradient(circle at 20% 20%, rgba(255,255,255,.06), transparent 60%),
    linear-gradient(180deg, #111, #0b0b0b);
  box-shadow:
    0 20px 40px rgba(0,0,0,.8),
    inset 0 1px 0 rgba(255,255,255,.05);
  display:flex;
  flex-direction:column;
  gap:18px;
}

/* HEADER */
.top{
  display:flex;
  justify-content:center;
  align-items:center;
}

.badge{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
}

.avatar{
  width:60px;height:60px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  border:2px solid var(--gold);
  background:linear-gradient(180deg,#222,#111);
  color:var(--gold2);
  font-size:2rem;
  box-shadow:0 0 18px rgba(255,215,0,.25);
}

.name b{
  font-family:'Oswald',sans-serif;
  font-size:2.4rem;
  font-weight:900;
  letter-spacing:1.5px;
  text-transform:uppercase;
  text-align:center;
}

/* PROGRESS */
.progress{
  border-radius:24px;
  padding:20px;
  background:linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.45));
  border:1px solid rgba(184,134,11,.25);
  box-shadow: inset 0 6px 18px rgba(0,0,0,.8);
}

.big{
  display:flex;
  justify-content:center;
  align-items:baseline;
  gap:12px;
  margin-bottom:14px;
}

.big .value{
  font-family:'Oswald',sans-serif;
  font-size:4.6rem;
  font-weight:900;
  line-height:1;
}

.big .unit{
  font-size:1.1rem;
  font-weight:800;
  color:#bbb;
  text-transform:uppercase;
  letter-spacing:1px;
}

.p1 .big .value{
  color:var(--p1txt);
  text-shadow:0 0 14px rgba(124,179,66,.6);
}
.p2 .big .value{
  color:var(--p2txt);
  text-shadow:0 0 14px rgba(255,112,67,.6);
}

/* BAR */
.bar{
  height:22px;
  border-radius:999px;
  background:#111;
  border:1px solid rgba(184,134,11,.35);
  box-shadow: inset 0 2px 6px black;
  margin:12px 0 18px;
  overflow:hidden;
}

.bar i{
  display:block;
  height:100%;
  width:0%;
  border-radius:999px;
  transition:width .6s ease;
}

.p1 .bar i{
  background:linear-gradient(90deg, var(--p1), var(--p1a), var(--p1));
}
.p2 .bar i{
  background:linear-gradient(90deg, var(--p2), var(--p2a), var(--p2));
}

/* KPI */
.grid2{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:14px;
}

.kpi{
  border-radius:20px;
  padding:14px 8px;
  text-align:center;
  background:linear-gradient(180deg, rgba(0,0,0,.6), rgba(0,0,0,.35));
  border:1px solid rgba(184,134,11,.3);
}

.kpi .label{
  font-size:20px;
  color:#ccc;
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:.7px;
}

.kpi .val{
  margin-top:6px;
  font-family:'Oswald',sans-serif;
  font-size:2.3rem;
  font-weight:900;
  color:var(--gold2);
  text-shadow:0 0 10px rgba(255,140,0,.6);
}

@media (max-width:1000px){
  .wrap{flex-direction:column}
}
</style>
</head>
<body>

<div class="wrap">

<div class="card p1">
  <div class="top">
    <div class="badge">
      <div class="avatar">
        <i class="fa-solid fa-binoculars"></i>
      </div>
      <div class="name">
        <b>SaXon</b>
      </div>
    </div>
  </div>

  <div class="progress">
    <div class="big">
      <div class="value" id="p1_left_big">0</div>
      <div class="unit">залишилось</div>
    </div>

    <div class="bar"><i id="p1_bar"></i></div>

    <div class="grid2">
      <div class="kpi">
        <div class="label">Додали глядачі</div>
        <div class="val" id="p1_added">0</div>
      </div>
      <div class="kpi">
        <div class="label">Виконано</div>
        <div class="val" id="p1_done">0</div>
      </div>
    </div>
  </div>
</div>

<div class="card p2">
  <div class="top">
    <div class="badge">
      <div class="avatar">
        <i class="fa-solid fa-crosshairs"></i>
      </div>
      <div class="name">
        <b>Devil_484</b>
      </div>
    </div>
  </div>

  <div class="progress">
    <div class="big">
      <div class="value" id="p2_left_big">0</div>
      <div class="unit">залишилось</div>
    </div>

    <div class="bar"><i id="p2_bar"></i></div>

    <div class="grid2">
      <div class="kpi">
        <div class="label">Додали глядачі</div>
        <div class="val" id="p2_added">0</div>
      </div>
      <div class="kpi">
        <div class="label">Виконано</div>
        <div class="val" id="p2_done">0</div>
      </div>
    </div>
  </div>
</div>

</div>

<!-- ЛОГІКА НЕ ЗМІНЕНА -->
<script>
const SHEET_ID="17phnEn-NW-OnrZg4DcW65r-Xoq6ScsdVjS5yL0SS3fk";
const GID="621327957";
const URL=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;
const REFRESH_MS = 15000;

function parseCSV(text){
  const rows = [];
  let row = [], cur = "", inQ = false;
  for(let i=0;i<text.length;i++){
    const ch = text[i];
    if(ch === '"'){
      if(inQ && text[i+1] === '"'){ cur += '"'; i++; }
      else inQ = !inQ;
    } else if(ch === ',' && !inQ){
      row.push(cur); cur = "";
    } else if(ch === '\n' && !inQ){
      if(cur.endsWith('\r')) cur = cur.slice(0,-1);
      row.push(cur);
      rows.push(row);
      row = []; cur = "";
    } else {
      cur += ch;
    }
  }
  if(cur.length || row.length){
    if(cur.endsWith('\r')) cur = cur.slice(0,-1);
    row.push(cur);
    rows.push(row);
  }
  return rows;
}

function toNumber(val){
  if(val === undefined || val === null) return 0;
  const s = String(val).replace(/[^\d\-]/g, "");
  const n = parseInt(s, 10);
  return Number.isFinite(n) ? n : 0;
}
const fmt = v => toNumber(v).toLocaleString("uk-UA");

function setBar(bar, done, left){
  const total = Math.max(0, done + left);
  const pct = total > 0 ? Math.max(0, Math.min(100, (done/total)*100)) : 0;
  bar.style.width = pct.toFixed(1) + "%";
}

async function load(){
  const r = await fetch(URL + "&_=" + Date.now());
  const t = await r.text();
  const d = parseCSV(t);

  const p1_added_v = toNumber(d[9]?.[2]);
  const p1_done_v  = toNumber(d[11]?.[2]);
  const p1_left_v  = toNumber(d[13]?.[2]);

  const p2_added_v = toNumber(d[9]?.[3]);
  const p2_done_v  = toNumber(d[11]?.[3]);
  const p2_left_v  = toNumber(d[13]?.[3]);

  p1_left_big.textContent = fmt(p1_left_v);
  p1_added.textContent    = fmt(p1_added_v);
  p1_done.textContent     = fmt(p1_done_v);
  setBar(p1_bar, p1_done_v, p1_left_v);

  p2_left_big.textContent = fmt(p2_left_v);
  p2_added.textContent    = fmt(p2_added_v);
  p2_done.textContent     = fmt(p2_done_v);
  setBar(p2_bar, p2_done_v, p2_left_v);
}

load().catch(console.log);
setInterval(()=>load().catch(console.log), REFRESH_MS);
</script>

</body>
</html>
